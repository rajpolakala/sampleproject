pipeline {
  agent any

  stages {
    stage('Build') {
      steps {
        script {
          def msbuildPath = findMsBuildPath()
          def solutionFilePath = "HelloWorld.sln"

          // Run the MSBuild command to build the solution
          bat "\"${msbuildPath}\" \"${solutionFilePath}\" /p:Configuration=Release"
        }
      }
    }
  }
}

def findMsBuildPath() {
  def msbuildDir = findFiles(glob: "E:/tools/**/MSBuild.exe")[0]?.parent
  if (msbuildDir) {
    return msbuildDir.path + "\\MSBuild.exe"
  } else {
    error "MSBuild path not found"
  }
}
